<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Books</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  <script src="https://static.elfsight.com/platform/platform.js" data-use-service-core defer></script>
<div class="elfsight-app-5837f75c-ade7-4dd8-a1cb-bd1cc2ed68a4" data-elfsight-app-lazy></div>
  <script type="module" src="./dynamiccon.js"></script>
  <script src="navbar.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.3.4/lib/darkmode-js.min.js"></script>
  <style>
    .loading-spinner {
      display: none;
      width: 3rem;
      height: 3rem;
      border: 0.5rem solid #f3f3f3;
      border-top: 0.5rem solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-[#172554]    bg-gray-900 text-white font-sans">
    <div class=" bg-[#172554] px-5 z-20 w-screen ">
       
        <div id="navbar-container"></div></div>
  <div class="container mx-auto py-10 px-5">
    <h1 class="text-4xl font-bold text-center mb-8 ">Reading Room</h1>
    <input type="text" id="search-bar" class="w-full mb-4 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Search by title or description...">
    <div id="loading-spinner" class="loading-spinner mx-auto mb-4"></div>
    <div id="books-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Books will be injected here dynamically -->
    </div>
  </div>

  <script type="module">
    // Firebase configuration
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";


    const firebaseConfig = {
        apiKey: "AIzaSyCtaftgrL4p4wqNC2w211mUi8amkjw2kzM",
        authDomain: "profstudymate-6d0fc.firebaseapp.com",
        projectId: "profstudymate",
        storageBucket: "profstudymate.appspot.com",
        messagingSenderId: "141453158869",
        appId: "1:141453158869:web:d4ded426a90e9937e2f55c",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    async function renderBooks() {
  document.getElementById('loading-spinner').style.display = 'block'; // Show spinner while loading
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const userId = user.uid;
      const userDocRef = doc(db, 'users', userId);
      const userDoc = await getDoc(userDocRef);
      const bookIds = userDoc.data().bookid || [];

      const booksContainer = document.getElementById('books-container');
      booksContainer.innerHTML = '';

      for (const bookId of bookIds) {
        const bookDocRef = doc(db, 'books', bookId);
        const bookDoc = await getDoc(bookDocRef);
        const bookData = bookDoc.data();

        const bookCard = document.createElement('div');
        bookCard.className = "bg-white rounded-lg p-2 shadow-md overflow-hidden flex flex-col transform transition-transform hover:scale-105 duration-200";

        bookCard.innerHTML = `
          <img class="h-48 w-full object-cover rounded-t-lg" src="${bookData.image_url}" alt="${bookData.title}">
          <div class="p-4 flex flex-col flex-grow">
            <h2 class="text-xl font-semibold mb-2 text-gray-800">${bookData.title}</h2>
            <p class="text-gray-600 mb-4">${bookData.description}</p>
            <button class="mt-auto bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 open-pdf">
              Read Book
            </button>
          </div>
        `;

        booksContainer.appendChild(bookCard);

        // Add event listener to the button
        const button = bookCard.querySelector('.open-pdf');
        button.addEventListener('click', () => openPDF(bookData.pdf_url));
      }

      // Hide spinner once books are loaded
      document.getElementById('loading-spinner').style.display = 'none';

      // Search feature
      const searchBar = document.getElementById('search-bar');
      searchBar.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const bookCards = booksContainer.querySelectorAll('.bg-white');

        bookCards.forEach(card => {
          const title = card.querySelector('h2').textContent.toLowerCase();
          const description = card.querySelector('p').textContent.toLowerCase();

          if (title.includes(query) || description.includes(query)) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      });
    } else {
      console.error("User is not signed in.");
    }
  });
}


    // Function to open and display PDF
    function openPDF(pdfUrl) {
  // Extract the srcid from the PDF URL
  const url = new URL(pdfUrl);
  const fileId = url.pathname.split('/')[3];

  if (fileId) {
    const pdfContainer = document.createElement('div');
    pdfContainer.className = "fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50";

    pdfContainer.innerHTML = `
      <div class="bg-white w-screen h-screen rounded overflow-hidden relative">
        <iframe src="https://docs.google.com/gview?a=v&pid=explorer&chrome=false&api=true&embedded=true&srcid=${fileId}&hl=en&embedded=true" class="w-full h-full"></iframe>
     
        <button class="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full" onclick="this.closest('div').remove()">
          <span class="sr-only">Close</span>
          &#10005;
        </button>
      </div>
    `;

    document.body.appendChild(pdfContainer);
  } else {
    console.error('File ID not found in the PDF URL.');
  }
}


    // Render books on page load
    renderBooks();
  </script>
</body>
</html>
