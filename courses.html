<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Catalog</title>

  <!-- Firebase Compatibility Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script type="module" src="./dynamiccon.js"></script>
  <script type="module" src="./navbar.js"></script>
  <script src="bottomnv.js"></script>
  
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
        theme: {
            extend: {}
        },
        plugins: [
            function ({ addUtilities }) {
                addUtilities({
                    '.scrollbar-hide': {
                        '-ms-overflow-style': 'none', /* Hide scrollbar for IE and Edge */
                        'scrollbar-width': 'none', /* Hide scrollbar for Firefox */
                    },
                    '.scrollbar-hide::-webkit-scrollbar': {
                        display: 'none' /* Hide scrollbar for Chrome, Safari */
                    }
                })
            }
        ]
    };
</script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    select {
  background-color: transparent;
  color: inherit;



}



/* Remove background color from options */
option {
  background-color: transparent !important;
  color: black; /* Adjust text color as needed */
}

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 50;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 800px;
      overflow-y: auto;
      max-height: 90vh;
    }
  
  </style>
</head>
<body class="     bg-gray-900 text-white">

    <div class=" bg-[#172554] fixed top-0  px-5 z-20 w-screen ">
       
        <div id="navbar-container"></div></div>

  <!-- Page Container -->
  
  <div class="container mx-auto mt-36 px-4 lg:px-16 flex flex-col lg:flex-row gap-6">
    <!-- Mobile Drawer for Tags -->
  
    <div class="lg:hidden z-10">
        <button id="open-drawer" class="px-4 py-2 bg-transparent border border-gray-500 text-white rounded-lg flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 6h18M3 12h12m-12 6h18" />
            </svg>
            Filter
        </button>
        <div id="drawer" class="fixed mt-24  top-0 left-0 w-64 h-full bg-gray-900 shadow-lg p-4 transform -translate-x-full transition-transform overflow-scroll ">
            <button   id="close-drawer" class="mb-4 w-14 h-14 bg-gray-500/10 p-3 rounded-full hover:bg-red-600 transition-all">X</button>
          
            <!-- Tags Section for Mobile -->
            <div id="tags-container1" class="w-full mb-64">
                <!-- Tags will be dynamically injected here -->
            </div>
        </div>
    </div>
    
<div>
<!-- Search and Filter -->
<div class="flex flex-row  justify-between">
  <!-- Search Input with Icon -->
  <div class=" items-center border border-gray-700 p-3 rounded-lg hidden lg:flex">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M8 2a6 6 0 104.472 10.472l3.9 3.9a1 1 0 001.415-1.415l-3.9-3.9A6 6 0 008 2zM3 8a5 5 0 1110 0A5 5 0 013 8z" clip-rule="evenodd"/>
    </svg>
    <input type="text" placeholder="Search" class="ml-2 outline-none bg-transparent">
  </div>

  <!-- Dropdown for Sorting -->
  <select class="border border-gray-700 p-3 rounded-lg bg-transparent">
    <option   >Release Date (newest first)</option>
    <option >Release Date (oldest first)</option>
    <option>Course Title (A-Z)</option>
    <option>Course Title (Z-A)</option>
  </select>
</div>


  <div class="flex">
    <!-- Tags Section for Larger Screens -->
    <div id="tags-container" class="hidden lg:block w-full lg:w-1/4  shadow-md rounded-lg p-4">
     
     <!-- Tags will be dynamically injected here -->
 </div>
 
 <!-- Main Content -->
 <div class="flex-1">
     <!-- Page Title -->
     <div class="mb-8 text-center">
  
     </div>
     
     <!-- Courses Grid -->
     <div id="course-list" class="mb-44 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
         <!-- Courses will be dynamically injected here -->
     </div>
 </div>
  </div>
</div>
</div>



  </div>
<!-- Modal -->
<div id="course-modal" class="modal px-2 ">
    <div class="relative modal-content bg-white p-0 shadow-lg rounded-lg w-full   lg:max-w-2xl mx-auto shadow-2xl rounded-lg  cursor-pointer border border-gray-500 bg-gray-900 scrollbar-hide  ">
      <!-- Close Button -->
     
     <button id="close-modal" class="absolute top-4 right-4 mb-4 text-center w-14 h-14 bg-gray-500/10 p-3 rounded-full text-2xl text-gray-500 hover:text-white hover:bg-red-600 transition-all">&times;</button>
        
    <!-- Course Image -->
    <div class="mb-6">
      <img id="modal-image" src="" alt="Course Image" class="w-full  object-cover " />
  </div>
  
      <!-- Modal Title -->
     <div class="p-5">
                 <!-- Rating -->
    <p class="text-gray-300 text-sm flex items-center gap-2 mb-3 transition-all duration-500 ease-out hover:translate-x-1">
      
      <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> 
      <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> 
      <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> 
      <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> 
      <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> 
    </p>
      <h2 id="modal-title" class="text-3xl font-semibold mb-6 text-gray-100"></h2>
      
      <div class="flex flex-row"> <div></div> <p id="model-students"></p></div>
      <p id="model-ratings"></p>
<div class="flex flex-row sm:flex-row items-center justify-between   p-4 rounded-2xl w-full  mx-auto border border-white/20">
      <!-- Price Section -->
<div class="">




  
  <span class="text-lg font-semibold text-gray-700 dark:text-white">Price:</span> <span id="modal-price" class="text-green-500 font-bold p-2  text-lg"></span>
  </div>
  
  <!-- Enroll Button -->


  <button id="modal-enroll-button"  class="flex items-center space-x-2 border border-blue-500 text-blue-500 px-4 py-2 rounded-md hover:bg-blue-500 hover:text-white transition ">
    <i class="fas fa-school"></i>
    <span>Enroll Now</span>
  </button>
</div>

<div class="mt-5 mb-4"></div>
      <!-- Modal Description -->
      <div id="modal-description" 
     class="mb-6 text-gray-500 text-lg leading-relaxed space-y-3"></div>

  
      <!-- Course Information -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
        <!-- Created By -->
        <div>
          <p class="font-semibold text-gray-600">Created by:</p>
          <p id="modal-id" style="display: none;"></p>
          <p id="modal-author" class="text-blue-500"></p>
        </div>
        
        <!-- Updated At -->
        <div>
          <p class="font-semibold text-gray-600">Updated at:</p>
          <p id="modal-updated" class="text-gray-700"></p>
        </div>
      </div>
  
      <!-- Video URL -->
      <div class="mb-6">
        <p class="font-semibold text-gray-600">Video Preview:</p>
        <iframe id="modal-video" class="w-full h-64 rounded-lg shadow-md border border-gray-300" 
                src="#" allowfullscreen>
        </iframe>
      </div>
      
  
<!-- Tags Section -->

<div class="mb-6">
  <p class="font-semibold text-gray-600">Tags:</p>
  <div id="modal-tags" class="flex flex-wrap gap-2 mt-2 p-3 ">
    <!-- Tags will be dynamically inserted here -->
  </div>
</div>





  
      <!-- Summary -->
      <div class="mb-6 p-5 border border-gray-300 rounded-xl shadow-md bg-white">
        <h3 class="font-semibold text-gray-800 text-lg">Summary:</h3>
        <p id="modal-summary" class="text-gray-600 text-sm mt-2"></p>
      </div>
      
  
      <!-- Requirements -->
      <div class="mb-6">
        <p class="font-semibold text-gray-600">Requirements:</p>
        <ul id="modal-requirements" class="list-disc pl-5 text-gray-600"></ul>
      </div>
  
      <!-- Learnings -->
      <div class="mb-6">
        <p class="font-semibold text-gray-600">What you'll learn:</p>
        <ul id="modal-learnings" class="list-disc pl-5 text-gray-600"></ul>
      </div>
  
      <!-- Languages -->
      <div class="mb-6">
        <p class="font-semibold text-gray-600">Language(s):</p>
        <ul id="modal-language" class="list-disc pl-5 text-gray-600"></ul>
      </div>
  
      <!-- Duration -->
      <div class="mb-6">
        <p class="font-semibold text-gray-600">Duration:</p>
        <span id="modal-duration" class="text-gray-700"></span>
      </div>
  
      <!-- Created At -->
      <div>
        <p class="font-semibold text-gray-600">Created at:</p>
        <span id="modal-created" class="text-gray-700"></span>
      </div>
    </div>
     </div>
    
  </div>
 
  <footer>
    <div
      class="fixed z-50 bottom-0 right-0 left-0"
      id="navbar-container1"
    ></div>
  </footer>
  <script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCtaftgrL4p4wqNC2w211mUi8amkjw2kzM",
      authDomain: "profstudymate-6d0fc.firebaseapp.com",
      projectId: "profstudymate",
      storageBucket: "profstudymate.appspot.com",
      messagingSenderId: "141453158869",
      appId: "1:141453158869:web:d4ded426a90e9937e2f55c",
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);

    // Get Firestore and Authentication instances
    const db = firebase.firestore(app);
    const auth = firebase.auth(app);

    // Convert Firestore Timestamp to Human-Readable Date

    
    const formatTimestamp = (timestamp) => {
      if (!timestamp) return "Unknown";
      const date = new Date(timestamp.seconds * 1000);
      return date.toLocaleDateString(undefined, { year: "numeric", month: "long", day: "numeric" });
    };

    // Render Array Data as List
    const renderArrayAsList = (array, containerId) => {
      const container = document.getElementById(containerId);
      container.innerHTML = ""; // Clear previous content
      if (Array.isArray(array) && array.length > 0) {
        array.forEach((item) => {
          const li = document.createElement("li");
          li.textContent = item;
          container.appendChild(li);
        });
      } else {
        const li = document.createElement("li");
        li.textContent = "None";
        container.appendChild(li);
      }
    };

    // Fetch Courses from Firestore
    const fetchCourses = async (tagId = null) => {
      try {
        const coursesRef = db.collection("courses");
        let query = coursesRef;
        if (tagId) {
          query = coursesRef.where('tag_ids', 'array-contains', tagId);
        }
        const courseSnapshot = await query.get();
        const courses = courseSnapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));
        return courses;
      } catch (error) {
        console.error("Error fetching courses:", error);
        return [];
      }
    };
    // Fetch Tags by IDs
    const fetchTags = async (tagIds) => {
      try {
        const tagsRef = db.collection("tags");
        const tagPromises = tagIds.map((tagId) => tagsRef.doc(tagId).get());
        const tagSnapshots = await Promise.all(tagPromises);
        return tagSnapshots.map((tagSnap) => tagSnap.data()?.name || "Unknown");
      } catch (error) {
        console.error("Error fetching tags:", error);
        return [];
      }
    };

    const fetchAllTags = async () => {
    try {
        const tagsSnapshot = await db.collection("tags").get();
        const tagsContainer = document.getElementById("tags-container");
        tagsContainer.innerHTML = ""; // Clear existing content

        // Create category title
        const categoryTitle = document.createElement("h2");
        categoryTitle.textContent = "Category";
        categoryTitle.className = "text-xl font-bold text-gray-100 mb-4 uppercase tracking-wide border-b border-gray-700 pb-2";
        tagsContainer.appendChild(categoryTitle);

        // Wrapper for tags
        const tagsWrapper = document.createElement("div");
        tagsWrapper.className = "space-y-2";

        // Create "All" filter
        const allTagLabel = document.createElement("label");
        allTagLabel.className = "flex items-center space-x-3 cursor-pointer p-3 rounded-lg transition bg-gray-900 hover:bg-gray-800 shadow-md";
        
        const allTagCheckboxWrapper = document.createElement("div");
        allTagCheckboxWrapper.className = "relative flex items-center justify-center";

        const allTagCheckbox = document.createElement("input");
        allTagCheckbox.type = "checkbox";
        allTagCheckbox.className = "tag-checkbox hidden";
        allTagCheckbox.checked = true; // Default selected

        const allCustomCheckbox = document.createElement("div");
        allCustomCheckbox.className = "w-6 h-6 border-2 border-gray-500 rounded-md flex items-center justify-center transition-all duration-200 ease-in-out bg-blue-500 border-blue-500";

        const allCheckmark = document.createElement("span");
        allCheckmark.className = "text-blue-500 text-lg";
        allCheckmark.innerHTML = "✔";

        allCustomCheckbox.appendChild(allCheckmark);
        allTagCheckboxWrapper.appendChild(allTagCheckbox);
        allTagCheckboxWrapper.appendChild(allCustomCheckbox);

        const allTagText = document.createElement("span");
        allTagText.className = "text-gray-300 font-medium text-base";
        allTagText.textContent = "All";

        allTagLabel.appendChild(allTagCheckboxWrapper);
        allTagLabel.appendChild(allTagText);

        // Handle "All" filter selection
        allTagCheckbox.addEventListener("change", () => {
            if (allTagCheckbox.checked) {
                allCustomCheckbox.classList.add("bg-blue-500", "border-blue-500");
                allCheckmark.classList.remove("hidden");

                document.querySelectorAll(".tag-checkbox").forEach(tag => {
                    if (tag !== allTagCheckbox) {
                        tag.checked = false;
                        tag.dispatchEvent(new Event("change"));
                    }
                });

                renderCourses(null);
            }
        });

        allTagLabel.addEventListener("click", () => {
            allTagCheckbox.checked = true;
            allTagCheckbox.dispatchEvent(new Event("change"));
        });

        tagsWrapper.appendChild(allTagLabel);

        // Render tags
        tagsSnapshot.forEach((doc) => {
            const tagId = doc.id;
            const tagName = doc.data().name;

            const tagLabel = document.createElement("label");
            tagLabel.className = "flex items-center space-x-3 cursor-pointer p-3 rounded-lg transition bg-gray-900 hover:bg-gray-800 shadow-md";
            
            const tagCheckboxWrapper = document.createElement("div");
            tagCheckboxWrapper.className = "relative flex items-center justify-center";

            const tagCheckbox = document.createElement("input");
            tagCheckbox.type = "checkbox";
            tagCheckbox.className = "tag-checkbox hidden";

            const customCheckbox = document.createElement("div");
            customCheckbox.className = "w-6 h-6 border-2 border-gray-500 rounded-md flex items-center justify-center transition-all duration-200 ease-in-out";

            const checkmark = document.createElement("span");
            checkmark.className = "hidden text-blue-500 text-lg";
            checkmark.innerHTML = "✔";

            tagCheckboxWrapper.appendChild(tagCheckbox);
            customCheckbox.appendChild(checkmark);
            tagCheckboxWrapper.appendChild(customCheckbox);

            const tagText = document.createElement("span");
            tagText.className = "text-gray-300 font-medium text-base";
            tagText.textContent = tagName;

            tagLabel.appendChild(tagCheckboxWrapper);
            tagLabel.appendChild(tagText);

            tagCheckbox.addEventListener("change", () => {
                if (tagCheckbox.checked) {
                    customCheckbox.classList.add("bg-blue-500", "border-blue-500");
                    checkmark.classList.remove("hidden");

                    // Uncheck "All" when selecting any tag
                    allTagCheckbox.checked = false;
                    allCustomCheckbox.classList.remove("bg-blue-500", "border-blue-500");
                    allCheckmark.classList.add("hidden");
                } else {
                    customCheckbox.classList.remove("bg-blue-500", "border-blue-500");
                    checkmark.classList.add("hidden");
                }
                renderCourses(tagId);
            });

            tagLabel.addEventListener("click", () => {
                tagCheckbox.checked = !tagCheckbox.checked;
                tagCheckbox.dispatchEvent(new Event("change"));
            });

            tagsWrapper.appendChild(tagLabel);
        });

        tagsContainer.appendChild(tagsWrapper);

        // Create Clear Filter Button
        const clearButton = document.createElement("button");
        clearButton.innerHTML = "X Clear All Filters";
        clearButton.className = "mt-6 flex items-center justify-center gap-2 px-5 py-2.5 text-blue-400 border border-blue-500 rounded-lg hover:bg-blue-500 hover:text-white transition text-sm font-semibold w-full shadow-md";
        
        clearButton.addEventListener("click", () => {
            document.querySelectorAll(".tag-checkbox").forEach(tag => {
                tag.checked = false;
                tag.dispatchEvent(new Event("change"));
            });

            allTagCheckbox.checked = true;
            allTagCheckbox.dispatchEvent(new Event("change"));
        });

        tagsContainer.appendChild(clearButton);
    } catch (error) {
        console.error("Error fetching tags:", error);
    }
};


const fetchAllTags1 = async () => {
    try {
        const tagsSnapshot = await db.collection("tags").get();
        const tagsContainer = document.getElementById("tags-container1");
        tagsContainer.innerHTML = ""; // Clear existing content

        // Create category title
        const categoryTitle = document.createElement("h2");
        categoryTitle.textContent = "Category";
        categoryTitle.className = "text-xl font-bold text-gray-100 mb-4 uppercase tracking-wide border-b border-gray-700 pb-2";
        tagsContainer.appendChild(categoryTitle);

        // Wrapper for tags
        const tagsWrapper = document.createElement("div");
        tagsWrapper.className = "space-y-2";

        // Create "All" filter
        const allTagLabel = document.createElement("label");
        allTagLabel.className = "flex items-center space-x-3 cursor-pointer p-3 rounded-lg transition bg-gray-900 hover:bg-gray-800 shadow-md";
        
        const allTagCheckboxWrapper = document.createElement("div");
        allTagCheckboxWrapper.className = "relative flex items-center justify-center";

        const allTagCheckbox = document.createElement("input");
        allTagCheckbox.type = "checkbox";
        allTagCheckbox.className = "tag-checkbox hidden";
        allTagCheckbox.checked = true; // Default selected

        const allCustomCheckbox = document.createElement("div");
        allCustomCheckbox.className = "w-6 h-6 border-2 border-gray-500 rounded-md flex items-center justify-center transition-all duration-200 ease-in-out bg-blue-500 border-blue-500";

        const allCheckmark = document.createElement("span");
        allCheckmark.className = "text-blue-500 text-lg";
        allCheckmark.innerHTML = "✔";

        allCustomCheckbox.appendChild(allCheckmark);
        allTagCheckboxWrapper.appendChild(allTagCheckbox);
        allTagCheckboxWrapper.appendChild(allCustomCheckbox);

        const allTagText = document.createElement("span");
        allTagText.className = "text-gray-300 font-medium text-base";
        allTagText.textContent = "All";

        allTagLabel.appendChild(allTagCheckboxWrapper);
        allTagLabel.appendChild(allTagText);

        // Handle "All" filter selection
        allTagCheckbox.addEventListener("change", () => {
            if (allTagCheckbox.checked) {
                allCustomCheckbox.classList.add("bg-blue-500", "border-blue-500");
                allCheckmark.classList.remove("hidden");

                document.querySelectorAll(".tag-checkbox").forEach(tag => {
                    if (tag !== allTagCheckbox) {
                        tag.checked = false;
                        tag.dispatchEvent(new Event("change"));
                    }
                });

                renderCourses(null);
            }
        });

        allTagLabel.addEventListener("click", () => {
            allTagCheckbox.checked = true;
            allTagCheckbox.dispatchEvent(new Event("change"));
        });

        tagsWrapper.appendChild(allTagLabel);

        // Render tags
        tagsSnapshot.forEach((doc) => {
            const tagId = doc.id;
            const tagName = doc.data().name;

            const tagLabel = document.createElement("label");
            tagLabel.className = "flex items-center space-x-3 cursor-pointer p-3 rounded-lg transition bg-gray-900 hover:bg-gray-800 shadow-md";
            
            const tagCheckboxWrapper = document.createElement("div");
            tagCheckboxWrapper.className = "relative flex items-center justify-center";

            const tagCheckbox = document.createElement("input");
            tagCheckbox.type = "checkbox";
            tagCheckbox.className = "tag-checkbox hidden";

            const customCheckbox = document.createElement("div");
            customCheckbox.className = "w-6 h-6 border-2 border-gray-500 rounded-md flex items-center justify-center transition-all duration-200 ease-in-out";

            const checkmark = document.createElement("span");
            checkmark.className = "hidden text-blue-500 text-lg";
            checkmark.innerHTML = "✔";

            tagCheckboxWrapper.appendChild(tagCheckbox);
            customCheckbox.appendChild(checkmark);
            tagCheckboxWrapper.appendChild(customCheckbox);

            const tagText = document.createElement("span");
            tagText.className = "text-gray-300 font-medium text-base";
            tagText.textContent = tagName;

            tagLabel.appendChild(tagCheckboxWrapper);
            tagLabel.appendChild(tagText);

            tagCheckbox.addEventListener("change", () => {
                if (tagCheckbox.checked) {
                    customCheckbox.classList.add("bg-blue-500", "border-blue-500");
                    checkmark.classList.remove("hidden");

                    // Uncheck "All" when selecting any tag
                    allTagCheckbox.checked = false;
                    allCustomCheckbox.classList.remove("bg-blue-500", "border-blue-500");
                    allCheckmark.classList.add("hidden");
                } else {
                    customCheckbox.classList.remove("bg-blue-500", "border-blue-500");
                    checkmark.classList.add("hidden");
                }
                renderCourses(tagId);
            });

            tagLabel.addEventListener("click", () => {
                tagCheckbox.checked = !tagCheckbox.checked;
                tagCheckbox.dispatchEvent(new Event("change"));
            });

            tagsWrapper.appendChild(tagLabel);
        });

        tagsContainer.appendChild(tagsWrapper);

        // Create Clear Filter Button
        const clearButton = document.createElement("button");
        clearButton.innerHTML = "X Clear All Filters";
        clearButton.className = "mt-6 flex items-center justify-center gap-2 px-5 py-2.5 text-blue-400 border border-blue-500 rounded-lg hover:bg-blue-500 hover:text-white transition text-sm font-semibold w-full shadow-md";
        
        clearButton.addEventListener("click", () => {
            document.querySelectorAll(".tag-checkbox").forEach(tag => {
                tag.checked = false;
                tag.dispatchEvent(new Event("change"));
            });

            allTagCheckbox.checked = true;
            allTagCheckbox.dispatchEvent(new Event("change"));
        });

        tagsContainer.appendChild(clearButton);
    } catch (error) {
        console.error("Error fetching tags:", error);
    }
};


const style = document.createElement('style');
style.innerHTML = `
  
    .expandable-content {
        display: none;
    }
    .expandable-content.expanded {
        display: flex;
    }
`;

document.head.appendChild(style);


const renderCourses = async (tagId = null) => {
    const courseList = document.getElementById("course-list");
    courseList.innerHTML = `  <div class="fixed top-0 right-0 left-0 bottom-0"><div class="text-center flex flex-col items-center justify-center w-screen h-screen">
    <div class="animate-spin  rounded-full h-16 w-16 border-t-4 border-b-4 border-[#f5f5f5] "></div>
    <p class="text-[#dbdbdb] text-lg font-semibold">Loading...</p>
  </div></div> `; // Loading state

    let courses = await fetchCourses(); // Fetch all courses
    if (tagId) {
        // Filter courses by tagId
        courses = courses.filter(course => course.tag_ids.includes(tagId));
    }

    if (courses.length === 0) {
        courseList.innerHTML = "<p class='text-center text-gray-500'>No courses available.</p>";
        return;
    }

    // Render courses
    courseList.innerHTML = courses
        .map((course) => {
            const imageUrl = course.image_url || 'https://via.placeholder.com/400x200?text=No+Image';
            return `
                <div
  class="relative shadow-2xl rounded-lg overflow-hidden cursor-pointer border border-gray-500 bg-gray-900 transition-all duration-500 ease-out hover:scale-[1.05] hover:shadow-pink-500/50 hover:border-pink-500/70"
         onclick="showCourseDetails('${course.id}')"
> 

  <div class="relative overflow-hidden">
    <img 
      src="${imageUrl}" 
      alt="${course.name}" 
      class="w-full object-cover transition-transform duration-500 ease-out hover:scale-110"
    />
    <div class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-500 ease-out hover:opacity-100"></div>
  </div>

  <!-- Course Info -->
  <div class="p-5 rounded-b-lg">
        <!-- Rating -->
    <p class="text-gray-300 text-sm flex items-center gap-2 mb-3 transition-all duration-500 ease-out hover:translate-x-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg>
    </p>
    <!-- Course Title -->
    <h3 class="text-lg font-semibold text-white flex items-center gap-2 mb-3 transition-all duration-500 ease-out hover:translate-x-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-pink-400 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 14l9-5-9-5-9 5 9 5zm0 7v-6m0 0L3 9m9 5l9-5" />
      </svg>
      ${course.name}
    </h3>

    <!-- Students Count -->
    <p class="text-gray-400 text-sm flex items-center gap-2 mb-2 transition-all duration-500 ease-out hover:translate-x-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-400 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M7 10l5-5m0 0l5 5m-5-5v12" />
      </svg>
      ${course.students || 0} students
    </p>


    <!-- Author -->
    <p class="text-white font-semibold text-lg flex items-center gap-3 transition-all duration-500 ease-out hover:translate-x-1 mb-10">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A9 9 0 1118.88 17.8M15 19c0-2-3-3-3-3s-3 1-3 3m3-14a4 4 0 110 8 4 4 0 010-8z" />
      </svg>
    <span class="text-sm">by-${course.author.name}</span>
    </p>
    <!-- Price -->
   <div class="flex py-5 flex-row justify-between border-t border-gray-700">
      <p class="text-lg font-semibold flex items-center gap-2 transition-all duration-500 ease-out hover:translate-x-1 ${course.price_status === 'free' ? 'text-green-400' : 'text-white'}">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 ${course.price_status === 'free' ? 'text-green-500' : 'text-green-400'} transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-2.5 0-4 1.5-4 3s1.5 3 4 3 4-1.5 4-3-1.5-3-4-3zm0 10v2m-4-2a4 4 0 018 0" />
      </svg>
      ${course.price_status === "free" ? "Free" : `₵${course.pricee}`} 
    </p>
     <button  class="flex items-center space-x-2 border border-blue-500 text-blue-500 px-4 py-2 rounded-md hover:bg-blue-500 hover:text-white transition add-to-cart-btn">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Add to cart</span>
                  </button>
    </div>




 <!-- Add to Favorite Icon -->
   <div class="absolute top-3 right-3 bg-white p-2 rounded-full cursor-pointer hover:bg-gray-700 transition duration-300" onclick="addToFavorites(event, '${course.id}')">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-blue-500 hover:text-red-500 transition duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 21l-1.45-1.35C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09A6.174 6.174 0 0116.5 3C19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.15L12 21z" />
    </svg>
  </div>

  </div>
</div>
          `;
        })
        .join("");
        fetchAllTags()
        fetchAllTags1()
};


      // Show Course Details in Modal
      const showCourseDetails = async (courseId) => {
      showErrorToast()
      const coursesRef = db.collection("courses");
      const courseDoc = await coursesRef.doc(courseId).get();
      const course = courseDoc.data();

      // Fetch Tags
// Fetch Tags
const tags = course.tag_ids ? await fetchTags(course.tag_ids) : [];
// Define an array of colors for tags
const tagColors = [
  "bg-blue-500", "bg-green-500", "bg-red-500", 
  "bg-yellow-500", "bg-purple-500", "bg-pink-500", 
  "bg-indigo-500", "bg-teal-500", "bg-orange-500"
];
// Populate Modal
document.getElementById("modal-image").src = course.image_url;
document.getElementById("modal-title").innerText = course.name;
document.getElementById("modal-description").innerHTML = course.meta?.description || "<p>No description available.</p>";
document.getElementById("modal-author").innerText = course.author?.name || "Unknown";
document.getElementById("modal-updated").innerText = formatTimestamp(course.updated_at);
document.getElementById("modal-video").innerText = course.video_url || "No video available";
document.getElementById("modal-video").href = course.video_url || "#";
document.getElementById("modal-summary").innerText = course.meta?.summary || "No summary available";
document.getElementById("modal-id").innerText = course.author?.id || "Unknown";
document.getElementById("modal-duration").innerText = course.meta?.duration || "Unknown";
document.getElementById("modal-created").innerText = formatTimestamp(course.created_at);

// Render lists
renderArrayAsList(course.requirements || [], "modal-requirements");
renderArrayAsList(course.learns || [], "modal-learnings");
renderArrayAsList(course.language || [], "modal-language");

// Render capsule-styled tags
const tagContainer = document.getElementById("modal-tags");
tagContainer.innerHTML = ""; // Clear previous tags

if (tags.length > 0) {
  tags.forEach((tag, index) => {
    const tagElement = document.createElement("span");
    tagElement.textContent = tag;

    // Assign a color based on the index (loops through the colors array)
    const colorClass = tagColors[index % tagColors.length];

    tagElement.className = `px-3 py-1 text-sm font-medium text-white ${colorClass} rounded-full`;
    tagContainer.appendChild(tagElement);
  });
} else {
  tagContainer.innerText = "None";
}

// Add Price to Modal
document.getElementById("modal-price").innerText = course.price_status === "free" ? "Free" : `₵${course.pricee}`;

const userid = auth.currentUser.uid;
const user = auth.currentUser;

// Add Enroll Button Link
document.getElementById("modal-enroll-button").addEventListener("click", async function () {
  if (course.price_status === "free") {
    try {
      // Update user's enrolled courses
      await db.collection("users").doc(userid).update({
        course_id: firebase.firestore.FieldValue.arrayUnion(courseId),
      });

      console.log("Course data successfully written!");
      // Redirect or show a success message
    } catch (error) {
      console.error("Error writing document: ", error);
    }
  } else {
    // Fetch user referral code
    const coursesRef1 = db.collection("users");
    const courseDoc1 = await coursesRef1.doc(userid).get();
    const course1 = courseDoc1.data();
    const refcode = course1.underef || '';

    // Generate query params
    const queryParams = new URLSearchParams({
      userid: userid,
      id: courseId,
      title: course.name,
      amount: course.pricee,
      description: course.meta?.description,
      image_url: course.image_url,
      referalcode: refcode,
    }).toString();

    window.location.href = `coursecart.html?${queryParams}`;
  }
});

// Show Modal
document.getElementById("course-modal").style.display = "block";

    };

    document.addEventListener("DOMContentLoaded", () => {
      // Example: Set the author's name dynamically
      const authorElement = document.getElementById("modal-id");
      const clickElement = document.getElementById("modal-author");
      const authorName = authorElement.textContent.trim(); // Replace this with dynamic data if needed
      authorElement.textContent = authorName;

      // Add a click event listener
      clickElement.addEventListener("click", (event) => {
        event.preventDefault(); // Prevent default link behavior

        // Navigate to the author page
        window.location.href = `authorpages.html?name=${authorElement.textContent.trim()}`;
      });
    });

    // Close Modal
    document.getElementById("close-modal").addEventListener("click", () => {
      document.getElementById("course-modal").style.display = "none";
    });

    // Initialize
    renderCourses();
</script>





   <script>
    document.getElementById("showFormButton").addEventListener("click", function () {
     window.location.href ='./account.html'
    });

  
   
  </script>
    <script>
      function showErrorToast() {
          Toastify({
              text: "🚨 Create an account to view courses!",
              duration: 3000,
              close: true,
              gravity: "top",
              position: "right",
              backgroundColor: "linear-gradient(to right, #e74c3c, #c0392b)", // Red error gradient
              stopOnFocus: true,
          }).showToast();
      }
  </script>
<script>
  document.getElementById("open-drawer").addEventListener("click", function() {
      document.getElementById("drawer").classList.remove("-translate-x-full");
  });
  document.getElementById("close-drawer").addEventListener("click", function() {
      document.getElementById("drawer").classList.add("-translate-x-full");
  });
</script>
<script>
  const videoLink = "https://www.youtube.com/watch?v=xyz123"; // Example link
  document.getElementById("modal-video").src = videoLink.replace("watch?v=", "embed/");
</script>
</body>
</html>
