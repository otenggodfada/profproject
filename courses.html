<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Catalog</title>

  <!-- Firebase Compatibility Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script type="module" src="./dynamiccon.js"></script>
  <script type="module" src="./navbar.js"></script>
  <script src="bottomnv.js"></script>
  <script src="kaka.js"></script>
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="nava-links.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
  <script>
    tailwind.config = {
        theme: {
            extend: {}
        },
        plugins: [
            function ({ addUtilities }) {
                addUtilities({
                    '.scrollbar-hide': {
                        '-ms-overflow-style': 'none', /* Hide scrollbar for IE and Edge */
                        'scrollbar-width': 'none', /* Hide scrollbar for Firefox */
                    },
                    '.scrollbar-hide::-webkit-scrollbar': {
                        display: 'none' /* Hide scrollbar for Chrome, Safari */
                    }
                })
            }
        ]
    };
</script>

<style>
  @keyframes scroll {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }
  
  .scrolling {
    animation: scroll 10s linear infinite;
  }
</style>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    select {
  background-color: transparent;
  color: inherit;



}



/* Remove background color from options */
option {
  background-color: transparent !important;
  color: black; /* Adjust text color as needed */
}



 
  
  </style>
</head>
<script src="dark-mode.js"></script>
<body class=" flex flex-col justify-center items-center   bg-gray-900 text-white">

    <div class=" bg-[#172554] sticky top-0 z-20 w-full border-b ">
       
        <div id="navbar-container"></div></div>

<!-- Modal -->
<div id="course-modal" class=" hidden max-w-6xl  ">
  <p id="modal1-id" style="display: none;" ></p>
  <!-- <p id="modal-id" style="display: none;"></p> -->
  <div class="relative modal-content bg-white p-0    rounded-lg  cursor-pointer  bg-gray-900 scrollbar-hide  ">
    <!-- Close Button -->
   
   <button id="close-modal" class="absolute top-4 right-4 mb-4 text-center w-14 h-14 bg-gray-500/30 p-3 rounded-full text-2xl text-gray-500 hover:text-white hover:bg-red-600 transition-all">&times;</button>
      
  <!-- Course Image -->
  <div class="mb-6 ">
    <img id="modal-image" src="" alt="Course Image" class="w-full  object-cover " />
</div>

    <!-- Modal Title -->
   <div class="p-5">
               <!-- Rating -->
  <p class="text-gray-300 text-sm flex items-center gap-2 mb-3 transition-all duration-500 ease-out hover:translate-x-1">
    
    <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
    </svg> 
    <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
    </svg> 
    <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
    </svg> 
    <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
    </svg> 
    <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
    </svg> 
  </p>
    <h2 id="modal-title" class="text-3xl font-semibold mb-6 text-gray-100"></h2>
        <!-- Social Share Buttons -->
<div class="flex space-x-4 mt-4 mb-4">
  <a id="share-facebook" class="text-blue-600 hover:text-blue-800" target="_blank">
    <i class="fab fa-facebook-f text-xl"></i>
  </a>
  <a id="share-twitter" class="text-blue-400 hover:text-blue-600" target="_blank">
    <i class="fab fa-twitter text-xl"></i>
  </a>
  <a id="share-linkedin" class="text-blue-700 hover:text-blue-900" target="_blank">
    <i class="fab fa-linkedin-in text-xl"></i>
  </a>
  <a id="share-whatsapp" class="text-green-600 hover:text-green-800" target="_blank">
    <i class="fab fa-whatsapp text-xl"></i>
  </a>
</div>
    <div class="flex flex-row"> <div></div> <p id="model-students"></p></div>
    <p id="model-ratings"></p>







    

<!-- Left Side and Right Side Info -->
<div class="flex justify-center md:space-x-6 lg:space-x-10 flex-col-reverse md:flex-row lg:flex-row ">
  <!-- Preview And Descriptions -->
  <div class="max-w-lg">

    <!-- Video URL -->
  <div class="mb-6">
    <p class="font-semibold text-gray-600 flex items-center gap-2">
      <i class="fas fa-video text-gray-500"></i> Video Preview:
    </p>
    <!-- YouTube Video -->
<iframe class="w-full h-64 rounded-lg  border border-gray-500 mt-2" id="modal-video"   
allow="autoplay; encrypted-media; fullscreen; picture-in-picture" allowfullscreen style="display: none;">
</iframe>

<!-- Firebase Storage Direct Video -->
<video id="modal-video-player" class="w-full h-64 rounded-lg  border border-gray-500 mt-2" controls style="display: none;">
Your browser does not support the video tag.
</video>
    </div>
    
    
    
    <!-- Modal Description -->
    <div id="modal-description" class="mb-6 text-gray-500 text-lg leading-relaxed space-y-3"></div>

  </div>

<!-- Course Data -->
<div class="max-w-lg">
  <!-- price and enroll -->
  <div
    class="flex flex-row sm:flex-row items-center justify-between p-4 mb-4 rounded-2xl w-full  border border-white/20"
  >
    <!-- Price Section -->
    <div class="">
      <span class="text-lg font-semibold text-gray-700 dark:text-white"
        >Price:</span
      >
      <span
        id="modal-price"
        class="text-green-500 font-bold p-2 text-lg"
      ></span>
    </div>

    <!-- Enroll Button -->

    <button
      id="modal-enroll-button"
      class="flex items-center space-x-2 border border-blue-500 text-blue-500 px-4 py-2 rounded-md hover:bg-blue-500 hover:text-white transition"
    >
      <i class="fas fa-school"></i>
      <span>Enroll Now</span>
    </button>
  </div>



  <!-- Course Information -->
  <div
    class="grid grid-cols-2  sm:grid-cols-2 gap-6 mb-6 p-5  rounded-lg bg-gray-900 border border-gray-500"
  >
    <!-- Created By -->
    <div class="flex items-center gap-2">
      <i class="fas fa-user text-gray-500"></i>
      <div>
        <p class="font-semibold text-gray-600">Created by:</p>
        <p id="modal-id" style="display: none"></p>
        <p id="modal-author" class="text-blue-500 font-medium"></p>
      </div>
    </div>

    <!-- Updated At -->
    <div class="flex items-center gap-2">
      <i class="fas fa-clock text-gray-500"></i>
      <div>
        <p class="font-semibold text-gray-600">Created at:</p>
        <span id="modal-created" class="text-gray-700"></span>
      </div>
    </div>

      <!-- Languages -->
  <div class="mb-6">
    <p class="font-semibold text-gray-600 flex items-center gap-2">
      <i class="fas fa-language text-gray-500"></i> Language(s):
    </p>
    <ul id="modal-language" class="list-disc pl-5 text-gray-600"></ul>
  </div>

  <!-- Duration -->
  <div class="mb-6">
    <p class="font-semibold text-gray-600 flex items-center gap-2">
      <i class="fas fa-hourglass-half text-gray-500"></i> Duration:
    </p>
    <span id="modal-duration" class="text-gray-700"></span>
  </div>

  <!-- Created At -->
  <div>
    <p class="font-semibold text-gray-600 flex items-center gap-2">
      <i class="fas fa-calendar-alt text-gray-500"></i> Updated at:
    </p>

    <p id="modal-updated" class="text-gray-700"></p>
  </div>
  </div>

  <!-- Category Section -->
  <div class="mb-6">
    <p class="font-semibold text-gray-600 flex items-center gap-2">
      <i class="fas fa-tags text-gray-500"></i> Category:
    </p>
  <div class="flex flex-wrap gap-2 mt-2 p-3 bg-gray-900 border border-gray-500 rounded-lg">
    <div
    id="modal-category"
    class="flex flex-wrap gap-2 mt-2 p-3 bg-gray-100 rounded-lg "
    
  >
 
  </div>
  </div>
  </div>

  <!-- Tags Section -->
  <div class="mb-6">
    <p class="font-semibold text-gray-600 flex items-center gap-2">
      <i class="fas fa-tags text-gray-500"></i> Tags:
    </p>
    <div
      id="modal-tags"
      class="flex flex-wrap gap-2 mt-2 p-3 bg-gray-900 border border-gray-500 rounded-lg"
    >
      <!-- Tags will be dynamically inserted here -->
    </div>
  </div>




  <!-- Summary -->
  <div class="mb-6 p-5 border border-gray-300 rounded-xl shadow-md opacity-60 bg-white/50 ">
    <h3 class="font-semibold text-white text-lg flex items-center gap-2">
      <i class="fas fa-info-circle text-black"></i> Summary:
    </h3>
    <p id="modal-summary" class="text-black text-sm mt-2"></p>
  </div>

  <!-- Requirements -->
 
  <div class="mb-6">
    <details class="group">
      <summary class="flex items-center justify-between space-x-2 bg-white text-black px-4 py-2 rounded-md hover:bg-blue-500/30 hover:text-white  transition">
     <div>
      <i class="fas fa-list-check "></i> Requirements:
     </div> <i class="fas fa-arrow-down "></i>
      </summary>
      <ul id="modal-requirements" class="list-item  p-10 bg-white text-gray-600 rounded-b-lg mt-2"></ul>
    </details>
  </div>


  <!-- Learnings -->
  <div class="mb-6">
    <details class="group">
      <summary class="flex items-center justify-between space-x-2 bg-white text-black px-4 py-2 rounded-md hover:bg-blue-500/30 hover:text-white  transition">
     <div>
      <i class="fas fa-graduation-cap "></i> What you'll learn:
     </div> <i class="fas fa-arrow-down "></i>
      </summary>
      <ul id="modal-learnings" class="list-item  p-10 bg-white text-gray-600 rounded-b-lg mt-2"></ul>
    </details>
  </div>
  


</div>




</div>




  
</div>
  </div>
</div>

        <div id="loadingScreen" class="fixed inset-0  flex items-center justify-center z-50">
          <div class="loader border-t-4 border-blue-500 border-solid rounded-full w-16 h-16 animate-spin"></div>
        </div>
        <footer>
          <div
            class="fixed z-50 bottom-0 right-0 left-0"
            id="navbar-container1"
          ></div>
        </footer>
        
    
  <!-- Page Container -->
  
  <div class="container mx-auto mt-3 px-4 lg:px-16 flex flex-col lg:flex-row gap-6">
    <!-- Mobile Drawer for Tags -->
    

 
<div>
  
<!-- Search and Filter -->
<div class="w-full flex justify-center mt-5">
  <h1 id="lolo" class="text-3xl font-bold text-white">All Courses</h1>
</div>
<div class="flex flex-row  justify-between">
 

   
 <div class="flex flex-row justify-between mt-4 w-full space-x-2 overflow-x-auto scrollbar-hide ">

  <div>
    <select class="border border-gray-700 p-3 rounded-lg bg-transparent">
      <option   >Release Date (newest first)</option>
      <option >Release Date (oldest first)</option>
      <option>Course Title (A-Z)</option>
      <option>Course Title (Z-A)</option>
    </select>
  </div>
  <div class=" lg:hidden z-10">
      
    <div class="flex items-center space-x-24">
      <button id="open-drawer" class="px-4 py-2 bg-transparent border border-gray-500 text-white rounded-lg flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 6h18M3 12h12m-12 6h18" />
        </svg>
        Filter
    </button>
  
    </div>
      <div id="drawer" class="fixed mt-24  top-0 left-0 w-64 h-full bg-gray-900 shadow-lg p-4 transform -translate-x-full transition-transform overflow-scroll ">
          <button   id="close-drawer" class="mb-4 w-14 h-14 bg-gray-500/10 p-3 rounded-full hover:bg-red-600 transition-all">X</button>
        
          <!-- Tags Section for Mobile -->
          <div id="tags-container1" class="w-full mb-64">
              <!-- Tags will be dynamically injected here -->
          </div>
      </div>
  </div>
  <!-- Shopping Cart -->
<div id="cart-container" class="fixed z-50 bottom-20 right-5 bg-gray-900 shadow-lg border border-gray-700 rounded-lg w-80 p-4 hidden">
  <div class="flex justify-between items-center border-b pb-3">
    <h2 class="text-lg font-semibold text-white">Shopping Cart</h2>
    <button id="close-cart" class="text-red-500 text-xl">&times;</button>
  </div>
  <div id="cart-items" class="mt-4 space-y-2">
    <p class="text-gray-400 text-sm">Your cart is empty.</p>
  </div>
  <div class="mt-4 border-t pt-3">
    <p class="text-white font-semibold">Total: <span id="cart-total" class="text-green-400">â‚µ0.00</span></p>
    <button id="checkout-btn" class="w-full mt-3 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition">
      Checkout
    </button>
  </div>
</div>
  <!-- Cart Icon -->
<button id="open-cart" class="fixed bottom-5 z-50 mb-20 right-5 bg-gray-900 border border-blue-500 w-14 h-14 text-white p-3 rounded-full shadow-lg hover:bg-blue-600 transition">
  <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full ">0</span>
  ðŸ›’
</button>
 </div>
</div>
<div class="items-center border border-gray-700 p-3 rounded-lg mt-4 flex">
  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
    <path fill-rule="evenodd" d="M8 2a6 6 0 104.472 10.472l3.9 3.9a1 1 0 001.415-1.415l-3.9-3.9A6 6 0 008 2zM3 8a5 5 0 1110 0A5 5 0 013 8z" clip-rule="evenodd"/>
  </svg>
  <input
  type="text" 
  id="searchInput"
  placeholder="Search"
  class="outline-none bg-transparent ml-2 w-full "
  />
</div>

    <!-- Filters -->
    <div class="flex items-center mb-4 mt-4 space-x-6 bg-gray-800 bg-opacity-60 p-4 rounded-lg shadow-md overflow-auto scrollbar-hide ">
      <!-- All Checkbox -->
      <label for="all-filter" class="flex items-center space-x-2 cursor-pointer px-3 py-2 bg-gray-900 rounded-lg hover:bg-blue-600 transition">
          <input type="checkbox" id="all-filter" class="hidden peer">
          <div class="w-5 h-5 flex items-center justify-center border border-gray-500 rounded-md peer-checked:bg-blue-500 peer-checked:border-blue-500">
              <i class="fas fa-check text-white text-sm hidden peer-checked:block"></i>
          </div>
          <span class="text-white font-medium">All</span>
      </label>
  
      <!-- Free Checkbox -->
      <label for="free-filter" class="flex items-center space-x-2 cursor-pointer px-3 py-2 bg-gray-900 rounded-lg hover:bg-blue-600 transition">
          <input type="checkbox" id="free-filter" value="free" class="hidden peer">
          <div class="w-5 h-5 flex items-center justify-center border border-gray-500 rounded-md peer-checked:bg-blue-500 peer-checked:border-blue-500">
              <i class="fas fa-check text-white text-sm hidden peer-checked:block"></i>
          </div>
          <span class="text-white font-medium">Free</span>
      </label>
  
      <!-- Paid Checkbox -->
      <label for="paid-filter" class="flex items-center space-x-2 cursor-pointer px-3 py-2 bg-gray-900 rounded-lg hover:bg-blue-600 transition">
          <input type="checkbox" id="paid-filter" value="paid" class="hidden peer">
          <div class="w-5 h-5 flex items-center justify-center border border-gray-500 rounded-md peer-checked:bg-blue-500 peer-checked:border-blue-500">
              <i class="fas fa-check text-white text-sm hidden peer-checked:block"></i>
          </div>
          <span class="text-white font-medium">Paid</span>
      </label>
  </div>
 
<!-- Categories -->
<h1  class="text-3xl mb-4 font-bold text-white">Categories</h1>
  <div class="w-full flex flex-row justify-center rounded-lg relative">
    <div class="absolute top-0 left-0 w-10 h-full bg-gradient-to-r from-white to-transparent pointer-events-none"></div>
    <div class="absolute top-0 right-0 w-10 h-full bg-gradient-to-l from-white to-transparent pointer-events-none"></div>
  
    <div class="relative max-w-7xl overflow-x-auto py-2 scrollbar-hide" id="scrollContainer">
      <div
        class="flex flex-row space-x-4 animate-scroll whitespace-nowrap"
        id="categories"
      >
        <!-- Add category items dynamically here -->
      </div>
    </div>
  </div>
  
  <div class="flex">
    <!-- Tags Section for Larger Screens -->
    <div id="tags-container" class="hidden lg:block w-full lg:w-1/4  shadow-md rounded-lg p-4">
     
     <!-- Tags will be dynamically injected here -->
 </div>
 
 <!-- Main Content -->
 <div class="flex-1">
     <!-- Page Title -->
     <div class="mb-8 text-center">
  
     </div>
     
     <!-- Courses Grid -->
     <div id="course-list" class="mb-44 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
         <!-- Courses will be dynamically injected here -->
     </div>
 </div>
  </div>
</div>
</div>
<!-- Big Screen Footer -->
<div class="w-full" id="footer-container"></div>
<script src="footerp.js"></script>


  </div>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const container = document.getElementById("scrollContainer");
    const categories = document.getElementById("categories");

    // Duplicate items for seamless scroll
    categories.innerHTML += categories.innerHTML;

    // Auto-scroll behavior
    function startAutoScroll() {
      categories.classList.add("scrolling");
    }

    function stopAutoScroll() {
      categories.classList.remove("scrolling");
    }

    // Start auto-scroll
    startAutoScroll();

    // Pause auto-scroll when manually scrolling
    container.addEventListener("mouseenter", stopAutoScroll);
    container.addEventListener("mouseleave", startAutoScroll);
  });
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCtaftgrL4p4wqNC2w211mUi8amkjw2kzM",
      authDomain: "profstudymate-6d0fc.firebaseapp.com",
      projectId: "profstudymate",
      storageBucket: "profstudymate.appspot.com",
      messagingSenderId: "141453158869",
      appId: "1:141453158869:web:d4ded426a90e9937e2f55c",
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);

    // Get Firestore and Authentication instances
    const db = firebase.firestore(app);
    const auth = firebase.auth(app);

    // Convert Firestore Timestamp to Human-Readable Date

    const urlParams = new URLSearchParams(window.location.search);
const courseTitle = urlParams.get("title1");
const course_id = urlParams.get('courseid');


    // Convert Firestore Timestamp to Human-Readable Date
    async function fetchCategories() {
            const querySnapshot = await db.collection("categories").orderBy("index").get();
            let categoriesHtml = "";
            querySnapshot.forEach((doc) => {
                const { name, image_url } = doc.data();
                categoriesHtml += `
      
  
    <div class="relative min-w-max bg-white/20 backdrop-blur-lg border border-white/30  rounded-lg p-4 flex flex-row  items-center cursor-pointer transition transform hover:scale-105 "
        onclick="window.location.href='courses.html?title1=${encodeURIComponent(name)}'">
        <img src="${image_url}" alt="${name}" class="w-32 h-20 object-cover rounded-lg border-2 border-white">
        <h3 class="  text-lg font-semibold text-white mt-2 ml-2">${name}</h3>
    </div>

                `;
            });
            document.getElementById("categories").innerHTML = categoriesHtml;
        }

        document.addEventListener("DOMContentLoaded", fetchCategories);

document.addEventListener("DOMContentLoaded", function () {
 if(course_id){
  showCourseDetails(course_id)
 }
});








    const formatTimestamp = (timestamp) => {
      if (!timestamp) return "Unknown";
      const date = new Date(timestamp.seconds * 1000);
      return date.toLocaleDateString(undefined, { year: "numeric", month: "long", day: "numeric" });
    };

    function renderArrayAsList(array, elementId) {
    const container = document.getElementById(elementId);
    
    if (!container) {
        console.error(`Element with ID "${elementId}" not found.`);
        return;
    }

    container.innerHTML = ""; // Clear previous content

    if (!Array.isArray(array) || array.length === 0) {
        container.innerHTML = "<p>No learnings available.</p>";
        return;
    }

    const ul = document.createElement("ul");
    ul.style.listStyleType = "disc"; // Bullet points

    array.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item; // Assuming `item` is a string
        ul.appendChild(li);
    });

    container.appendChild(ul);
}


    // Fetch Courses from Firestore
    const fetchCourses = async (tagId = null) => {
    try {
        const coursesRef = db.collection("courses");
        let query = coursesRef;

        if (tagId) {
            query = coursesRef.where('tag_ids', 'array-contains', tagId);
        }

        const courseSnapshot = await query.get();
        const courses = await Promise.all(courseSnapshot.docs.map(async (doc) => {
            let courseData = { id: doc.id, ...doc.data() };
   // Skip courses with status "draft"
   if (courseData.status === "draft") {
                return null;
            }
            // Fetch category details
            if (courseData.cat_id) {
                const cateRef = db.collection("categories").doc(courseData.cat_id);
                const cateDoc = await cateRef.get();
                if (cateDoc.exists) {
                    courseData.categoryName = cateDoc.data().name || "Unknown";
                }
            }

            return courseData;
        }));

             // Filter out null values (draft courses)
             return courses.filter(course => course !== null);
        
    } catch (error) {
        console.error("Error fetching courses:", error);
        return [];
    } finally{
      if (courseTitle) {
    document.getElementById("lolo").textContent = courseTitle;
    const searchInput = document.getElementById("searchInput");

    searchInput.focus();
    searchInput.value = ""; // Clear input before typing

    let index = 0;




    function typeCharacter() {
        if (index < courseTitle.length) {
            searchInput.value += courseTitle[index];

            // Dispatch an actual "input" event to mimic real typing
            searchInput.dispatchEvent(new InputEvent("input", { bubbles: true }));

            index++;
            setTimeout(typeCharacter, 20); // Adjust typing speed (100ms per character)
        } else {
      
        }
    }

    function simulateBackspace() {
        if (searchInput.value.length > 0) {
            searchInput.value = searchInput.value.slice(0, -1);

            // Dispatch InputEvent again to simulate real input change
            searchInput.dispatchEvent(new InputEvent("input", { bubbles: true }));

            setTimeout(simulateBackspace, 50); // Adjust backspace speed
        }
    }

    // Start typing first
    typeCharacter();
}
    }
};

    // Fetch Tags by IDs
    const fetchTags = async (tagIds) => {
      try {
        const tagsRef = db.collection("tags");
        const tagPromises = tagIds.map((tagId) => tagsRef.doc(tagId).get());
        const tagSnapshots = await Promise.all(tagPromises);
        return tagSnapshots.map((tagSnap) => tagSnap.data()?.name || "Unknown");
      } catch (error) {
        console.error("Error fetching tags:", error);
        return [];
      }
    };

    const fetchAllTags = async () => {
    try {
        const tagsSnapshot = await db.collection("tags").get();
        const tagsContainer = document.getElementById("tags-container");
        tagsContainer.innerHTML = ""; // Clear existing content

        // Create category title
        const categoryTitle = document.createElement("h2");
        categoryTitle.textContent = "Tags";
        categoryTitle.className = "text-xl font-bold text-gray-100 mb-4 uppercase tracking-wide border-b border-gray-700 pb-2";
        tagsContainer.appendChild(categoryTitle);

        // Wrapper for tags
        const tagsWrapper = document.createElement("div");
        tagsWrapper.className = "space-y-2";

        // Create "All" filter
        const allTagLabel = document.createElement("label");
        allTagLabel.className = "flex items-center space-x-3 cursor-pointer p-3 rounded-lg transition bg-gray-900 hover:bg-gray-800 shadow-md";
        
        const allTagCheckboxWrapper = document.createElement("div");
        allTagCheckboxWrapper.className = "relative flex items-center justify-center";

        const allTagCheckbox = document.createElement("input");
        allTagCheckbox.type = "checkbox";
        allTagCheckbox.className = "tag-checkbox hidden";
        allTagCheckbox.checked = true; // Default selected

        const allCustomCheckbox = document.createElement("div");
        allCustomCheckbox.className = "w-6 h-6 border-2 border-gray-500 rounded-md flex items-center justify-center transition-all duration-200 ease-in-out bg-blue-500 border-blue-500";

        const allCheckmark = document.createElement("span");
        allCheckmark.className = "text-blue-500 text-lg";
        allCheckmark.innerHTML = "âœ”";

        allCustomCheckbox.appendChild(allCheckmark);
        allTagCheckboxWrapper.appendChild(allTagCheckbox);
        allTagCheckboxWrapper.appendChild(allCustomCheckbox);

        const allTagText = document.createElement("span");
        allTagText.className = "text-gray-300 font-medium text-base";
        allTagText.textContent = "All";

        allTagLabel.appendChild(allTagCheckboxWrapper);
        allTagLabel.appendChild(allTagText);

        // Handle "All" filter selection
        allTagCheckbox.addEventListener("change", () => {
            if (allTagCheckbox.checked) {
                allCustomCheckbox.classList.add("bg-blue-500", "border-blue-500");
                allCheckmark.classList.remove("hidden");

                document.querySelectorAll(".tag-checkbox").forEach(tag => {
                    if (tag !== allTagCheckbox) {
                        tag.checked = false;
                        tag.dispatchEvent(new Event("change"));
                    }
                });

                renderCourses(null);
            }
        });

        allTagLabel.addEventListener("click", () => {
            allTagCheckbox.checked = true;
            allTagCheckbox.dispatchEvent(new Event("change"));
        });

        tagsWrapper.appendChild(allTagLabel);

        // Render tags
        tagsSnapshot.forEach((doc) => {
            const tagId = doc.id;
            const tagName = doc.data().name;

            const tagLabel = document.createElement("label");
            tagLabel.className = "flex items-center space-x-3 cursor-pointer p-3 rounded-lg transition bg-gray-900 hover:bg-gray-800 shadow-md";
            
            const tagCheckboxWrapper = document.createElement("div");
            tagCheckboxWrapper.className = "relative flex items-center justify-center";

            const tagCheckbox = document.createElement("input");
            tagCheckbox.type = "checkbox";
            tagCheckbox.className = "tag-checkbox hidden";

            const customCheckbox = document.createElement("div");
            customCheckbox.className = "w-6 h-6 border-2 border-gray-500 rounded-md flex items-center justify-center transition-all duration-200 ease-in-out";

            const checkmark = document.createElement("span");
            checkmark.className = "hidden text-blue-500 text-lg";
            checkmark.innerHTML = "âœ”";

            tagCheckboxWrapper.appendChild(tagCheckbox);
            customCheckbox.appendChild(checkmark);
            tagCheckboxWrapper.appendChild(customCheckbox);

            const tagText = document.createElement("span");
            tagText.className = "text-gray-300 font-medium text-base";
            tagText.textContent = tagName;

            tagLabel.appendChild(tagCheckboxWrapper);
            tagLabel.appendChild(tagText);

            tagCheckbox.addEventListener("change", () => {
                if (tagCheckbox.checked) {
                    customCheckbox.classList.add("bg-blue-500", "border-blue-500");
                    checkmark.classList.remove("hidden");

                    // Uncheck "All" when selecting any tag
                    allTagCheckbox.checked = false;
                    allCustomCheckbox.classList.remove("bg-blue-500", "border-blue-500");
                    allCheckmark.classList.add("hidden");
                } else {
                    customCheckbox.classList.remove("bg-blue-500", "border-blue-500");
                    checkmark.classList.add("hidden");
                }
                renderCourses(tagId);
            });

            tagLabel.addEventListener("click", () => {
                tagCheckbox.checked = !tagCheckbox.checked;
                tagCheckbox.dispatchEvent(new Event("change"));
            });

            tagsWrapper.appendChild(tagLabel);
        });

        tagsContainer.appendChild(tagsWrapper);

        // Create Clear Filter Button
        const clearButton = document.createElement("button");
        clearButton.innerHTML = "X Clear All Filters";
        clearButton.className = "mt-6 flex items-center justify-center gap-2 px-5 py-2.5 text-blue-400 border border-blue-500 rounded-lg hover:bg-blue-500 hover:text-white transition text-sm font-semibold w-full shadow-md";
        
        clearButton.addEventListener("click", () => {
            document.querySelectorAll(".tag-checkbox").forEach(tag => {
                tag.checked = false;
                tag.dispatchEvent(new Event("change"));
            });

            allTagCheckbox.checked = true;
            allTagCheckbox.dispatchEvent(new Event("change"));
        });

        tagsContainer.appendChild(clearButton);
    } catch (error) {
        console.error("Error fetching tags:", error);
    }
};


const fetchAllTags1 = async () => {
    try {
        const tagsSnapshot = await db.collection("tags").get();
        const tagsContainer = document.getElementById("tags-container1");
        tagsContainer.innerHTML = ""; // Clear existing content

        // Create category title
        const categoryTitle = document.createElement("h2");
        categoryTitle.textContent = "Tags";
        categoryTitle.className = "text-xl font-bold text-gray-100 mb-4 uppercase tracking-wide border-b border-gray-700 pb-2";
        tagsContainer.appendChild(categoryTitle);

        // Wrapper for tags
        const tagsWrapper = document.createElement("div");
        tagsWrapper.className = "space-y-2";

        // Create "All" filter
        const allTagLabel = document.createElement("label");
        allTagLabel.className = "flex items-center space-x-3 cursor-pointer p-3 rounded-lg transition bg-gray-900 hover:bg-gray-800 shadow-md";
        
        const allTagCheckboxWrapper = document.createElement("div");
        allTagCheckboxWrapper.className = "relative flex items-center justify-center";

        const allTagCheckbox = document.createElement("input");
        allTagCheckbox.type = "checkbox";
        allTagCheckbox.className = "tag-checkbox hidden";
        allTagCheckbox.checked = true; // Default selected

        const allCustomCheckbox = document.createElement("div");
        allCustomCheckbox.className = "w-6 h-6 border-2 border-gray-500 rounded-md flex items-center justify-center transition-all duration-200 ease-in-out bg-blue-500 border-blue-500";

        const allCheckmark = document.createElement("span");
        allCheckmark.className = "text-blue-500 text-lg";
        allCheckmark.innerHTML = "âœ”";

        allCustomCheckbox.appendChild(allCheckmark);
        allTagCheckboxWrapper.appendChild(allTagCheckbox);
        allTagCheckboxWrapper.appendChild(allCustomCheckbox);

        const allTagText = document.createElement("span");
        allTagText.className = "text-gray-300 font-medium text-base";
        allTagText.textContent = "All";

        allTagLabel.appendChild(allTagCheckboxWrapper);
        allTagLabel.appendChild(allTagText);

        // Handle "All" filter selection
        allTagCheckbox.addEventListener("change", () => {
            if (allTagCheckbox.checked) {
                allCustomCheckbox.classList.add("bg-blue-500", "border-blue-500");
                allCheckmark.classList.remove("hidden");

                document.querySelectorAll(".tag-checkbox").forEach(tag => {
                    if (tag !== allTagCheckbox) {
                        tag.checked = false;
                        tag.dispatchEvent(new Event("change"));
                    }
                });

                renderCourses(null);
            }
        });

        allTagLabel.addEventListener("click", () => {
            allTagCheckbox.checked = true;
            allTagCheckbox.dispatchEvent(new Event("change"));
        });

        tagsWrapper.appendChild(allTagLabel);

        // Render tags
        tagsSnapshot.forEach((doc) => {
            const tagId = doc.id;
            const tagName = doc.data().name;

            const tagLabel = document.createElement("label");
            tagLabel.className = "flex items-center space-x-3 cursor-pointer p-3 rounded-lg transition bg-gray-900 hover:bg-gray-800 shadow-md";
            
            const tagCheckboxWrapper = document.createElement("div");
            tagCheckboxWrapper.className = "relative flex items-center justify-center";

            const tagCheckbox = document.createElement("input");
            tagCheckbox.type = "checkbox";
            tagCheckbox.className = "tag-checkbox hidden";

            const customCheckbox = document.createElement("div");
            customCheckbox.className = "w-6 h-6 border-2 border-gray-500 rounded-md flex items-center justify-center transition-all duration-200 ease-in-out";

            const checkmark = document.createElement("span");
            checkmark.className = "hidden text-blue-500 text-lg";
            checkmark.innerHTML = "âœ”";

            tagCheckboxWrapper.appendChild(tagCheckbox);
            customCheckbox.appendChild(checkmark);
            tagCheckboxWrapper.appendChild(customCheckbox);

            const tagText = document.createElement("span");
            tagText.className = "text-gray-300 font-medium text-base";
            tagText.textContent = tagName;

            tagLabel.appendChild(tagCheckboxWrapper);
            tagLabel.appendChild(tagText);

            tagCheckbox.addEventListener("change", () => {
                if (tagCheckbox.checked) {
                    customCheckbox.classList.add("bg-blue-500", "border-blue-500");
                    checkmark.classList.remove("hidden");

                    // Uncheck "All" when selecting any tag
                    allTagCheckbox.checked = false;
                    allCustomCheckbox.classList.remove("bg-blue-500", "border-blue-500");
                    allCheckmark.classList.add("hidden");
                } else {
                    customCheckbox.classList.remove("bg-blue-500", "border-blue-500");
                    checkmark.classList.add("hidden");
                }
                renderCourses(tagId);
            });

            tagLabel.addEventListener("click", () => {
                tagCheckbox.checked = !tagCheckbox.checked;
                tagCheckbox.dispatchEvent(new Event("change"));
            });

            tagsWrapper.appendChild(tagLabel);
        });

        tagsContainer.appendChild(tagsWrapper);

        // Create Clear Filter Button
        const clearButton = document.createElement("button");
        clearButton.innerHTML = "X Clear All Filters";
        clearButton.className = "mt-6 flex items-center justify-center gap-2 px-5 py-2.5 text-blue-400 border border-blue-500 rounded-lg hover:bg-blue-500 hover:text-white transition text-sm font-semibold w-full shadow-md";
        
        clearButton.addEventListener("click", () => {
            document.querySelectorAll(".tag-checkbox").forEach(tag => {
                tag.checked = false;
                tag.dispatchEvent(new Event("change"));
            });

            allTagCheckbox.checked = true;
            allTagCheckbox.dispatchEvent(new Event("change"));
        });

        tagsContainer.appendChild(clearButton);
    } catch (error) {
        console.error("Error fetching tags:", error);
    }
};


const style = document.createElement('style');
style.innerHTML = `
  
    .expandable-content {
        display: none;
    }
    .expandable-content.expanded {
        display: flex;
    }
`;

document.head.appendChild(style);


const renderCourses = async (tagId = null) => {
    const courseList = document.getElementById("course-list");
    courseList.innerHTML = `  <div class="fixed top-0 right-0 left-0 bottom-0"><div class="text-center flex flex-col items-center justify-center w-screen h-screen">
    
    <p class="text-[#dbdbdb] text-lg font-semibold"></p>
  </div></div> `; // Loading state

    let courses = await fetchCourses(); // Fetch all courses
    if (tagId) {
        // Filter courses by tagId
        courses = courses.filter(course => course.tag_ids.includes(tagId));
    }else{
      courseList.innerHTML = "<p class='text-center text-gray-500'>No courses available.</p>";
      document.getElementById("loadingScreen").classList.add("hidden");
    }

    if (courses.length === 0) {
        courseList.innerHTML = "<p class='text-center text-gray-500'>No courses available.</p>";
        return;
        document.getElementById("loadingScreen").classList.add("hidden");
    }
    document.getElementById("loadingScreen").classList.add("hidden");
    // Render courses
    courseList.innerHTML = courses
        .map((course) => {
            const imageUrl = course.image_url || 'https://via.placeholder.com/400x200?text=No+Image';
            return `
                <div
  class="relative shadow-2xl rounded-lg overflow-hidden cursor-pointer border border-gray-500 bg-gray-900 transition-all duration-500 ease-out hover:scale-[1.05] hover:shadow-pink-500/50 hover:border-pink-500/70"
       
> 

  <div class="relative overflow-hidden">
    <img 
      src="${imageUrl}" 
      alt="${course.name}" 
      class="w-full object-cover transition-transform duration-500 ease-out hover:scale-110"
    />
    <div class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-500 ease-out hover:opacity-100"></div>
  </div>

  <!-- Course Info -->
  <div class="p-5 rounded-b-lg">
        <!-- Rating -->
    <p class="text-gray-300 text-sm flex items-center gap-2 mb-3 transition-all duration-500 ease-out hover:translate-x-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg> <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.318l1.946 3.946 4.355.634-3.15 3.068.744 4.34L12 14.8l-3.895 2.065.744-4.34-3.15-3.068 4.355-.634L12 4.318z" />
      </svg>
    </p>
    <!-- Course Title -->
    <h3   onclick="showCourseDetails('${course.id}')"   class="text-lg font-semibold text-white flex items-center hover:text-blue-500 gap-2 mb-3 transition-all duration-500 ease-out hover:translate-x-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-pink-400 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 14l9-5-9-5-9 5 9 5zm0 7v-6m0 0L3 9m9 5l9-5" />
      </svg>
      ${course.name}
    </h3>
<!-- category -->
 <p class="text-gray-400 text-sm flex items-center gap-2 mb-2 transition-all duration-500 ease-out hover:translate-x-1 course-category">${course.categoryName || ""}</p>
    <!-- Students Count -->
    <p class="text-gray-400 text-sm flex items-center gap-2 mb-2 transition-all duration-500 ease-out hover:translate-x-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-400 transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M7 10l5-5m0 0l5 5m-5-5v12" />
      </svg>
      ${course.students || 0} students
    </p>


    <!-- Author -->
    <p class="text-white font-semibold text-lg flex items-center gap-3 transition-all duration-500 ease-out hover:translate-x-1 mb-10">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A9 9 0 1118.88 17.8M15 19c0-2-3-3-3-3s-3 1-3 3m3-14a4 4 0 110 8 4 4 0 010-8z" />
      </svg>
    <span class="text-sm">by-${course.author.name}</span>
    </p>
    


    <!-- Price -->
   <div class="flex py-5 flex-row justify-between border-t border-gray-700">
      <p class="text-lg font-semibold flex items-center gap-2 transition-all duration-500 ease-out hover:translate-x-1 ${course.pricee === '0' ? 'text-green-400' : 'text-white'}">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 ${course.pricee === '0' ? 'text-green-500' : 'text-green-400'} transition-transform duration-300 hover:scale-125" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-2.5 0-4 1.5-4 3s1.5 3 4 3 4-1.5 4-3-1.5-3-4-3zm0 10v2m-4-2a4 4 0 018 0" />
      </svg>
      ${course.pricee === "0" ? "Free" : `â‚µ${course.pricee}`} 
    </p>
<button class="add-to-cart-btn flex items-center space-x-2 border border-blue-500 text-blue-500 px-4 py-2 rounded-md hover:bg-blue-500 hover:text-white transition"
  data-id="${course.id}"
  data-title="${course.name}" 
  data-price="${course.pricee === '0' ? '0' : course.pricee}"

  data-image="${course.image_url || 'https://via.placeholder.com/150'}">
  <i class="fas fa-shopping-cart"></i>
  <span>Add to cart</span>
</button>




    </div>




 <!-- Add to Favorite Icon -->
   <div class="absolute top-3 right-3 bg-white p-2 rounded-full cursor-pointer hover:bg-gray-700 transition duration-300" onclick="addToFavorites(event, '${course.id}')">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-blue-500 hover:text-red-500 transition duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 21l-1.45-1.35C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09A6.174 6.174 0 0116.5 3C19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.15L12 21z" />
    </svg>
  </div>

  </div>
</div>
          `;
        })
        .join("");
        fetchAllTags()
        fetchAllTags1()
    
};



      // Show Course Details in Modal
      const showCourseDetails = async ( courseId,) => {
       // Opens the course modal
 
      const coursesRef = db.collection("courses");
      const courseDoc = await coursesRef.doc(courseId).get();
      const course = courseDoc.data();

      
      const catid = course.cat_id
const cateRef = db.collection("categories");
  const cateDoc = await cateRef.doc(catid).get();
  const category  = cateDoc.data();
      // Fetch Tags

// Populate Modal
document.getElementById("modal1-id").innerText= courseId;
document.getElementById("modal-image").src = course.image_url;
document.getElementById("modal-title").innerText = course.name;
document.getElementById("modal-description").innerHTML = course.meta?.description || "<p>No description available.</p>";
document.getElementById("modal-author").innerText = course.author?.name || "Unknown";
document.getElementById("modal-updated").innerText = formatTimestamp(course.updated_at);
document.getElementById("modal-video").innerText = course.video_url || "No video available";
document.getElementById("modal-language").innerText = course.meta?.language || "Unknown";
document.getElementById("modal-summary").innerText = course.meta?.summary || "No summary available";
document.getElementById("modal-id").innerText = course.author?.id || "Unknown";
document.getElementById("modal-duration").innerText = course.meta?.duration || "Unknown";
document.getElementById("modal-created").innerText = formatTimestamp(course.created_at);

updateShareLinks();
// Render lists
renderArrayAsList(course.meta?.requirements || [], "modal-requirements");
renderArrayAsList(course.meta?.learnings || [], "modal-learnings");

const modalCategory = document.getElementById("modal-category");
modalCategory.innerText = category.name || "Unknown";

modalCategory.className = "px-3 py-1 text-sm font-medium text-white bg-blue-500 rounded-full";

// Render capsule-styled tags
const tagContainer = document.getElementById("modal-tags");
tagContainer.innerHTML = ""; // Clear previous tags

 loadVideo(course.video_url);

// Ensure the video URL is valid

// Fetch Tags
const tags = course.tag_ids ? await fetchTags(course.tag_ids) : [];
const learning = course.learnings || [];
// Define an array of colors for tags
const tagColors = [
  "bg-blue-500", "bg-green-500", "bg-red-500", 
  "bg-yellow-500", "bg-purple-500", "bg-pink-500", 
  "bg-indigo-500", "bg-teal-500", "bg-orange-500"
];

if (tags.length > 0) {
  tags.forEach((tag, index) => {
    const tagElement = document.createElement("span");
    tagElement.textContent = tag;

    // Assign a color based on the index (loops through the colors array)
    const colorClass = tagColors[index % tagColors.length];

    tagElement.className = `px-3 py-1 text-sm font-medium text-white ${colorClass} rounded-full`;
    tagContainer.appendChild(tagElement);
  }

);
     // Show Modal
     document.getElementById("course-modal").style.display = "block";
document.getElementById("course-modal").scrollIntoView({ behavior: "smooth" });
} else {
  tagContainer.innerText = "None";
}

// Add Price to Modal
document.getElementById("modal-price").innerText = course.pricee === "0" ? "Free" : `â‚µ${course.pricee}`;
// Get current date and add three months
const expireDate = new Date();
expireDate.setMonth(expireDate.getMonth() + 3);
const userid = auth.currentUser.uid;
const user = auth.currentUser;

// Add Enroll Button Link
document.getElementById("modal-enroll-button").addEventListener("click", async function () {
  if (course.pricee === "0") {
    document.getElementById("loadingScreen").classList.remove("hidden");
    try {
     // Update user's enrolled courses
// Add course to the Courses subcollection with expire_date
await db.collection("users").doc(userid).collection("Courses").doc(courseId).set({
  course_id: courseId,
  expire_date: firebase.firestore.Timestamp.fromDate(new Date(expireDate)), // Ensure expireDate is a valid Date object
});


  console.log("Course data successfully written!");
  showSuccessToast1();

  // Wait for 10 seconds before redirecting
  setTimeout(() => {
    window.location.href = "mycourse.html";
  }, 3000);
} catch (error) {
  console.error("Error writing document: ", error);
}finally {
  // Hide loading screen after process is done
  document.getElementById("loadingScreen").classList.add("hidden");
}

  } else {
    // Fetch user referral code
    const coursesRef1 = db.collection("users");
    const courseDoc1 = await coursesRef1.doc(userid).get();
    const course1 = courseDoc1.data();
    const refcode = course1.underef || '';

    // Generate query params
    const queryParams = new URLSearchParams({
      userid: userid,
      id: courseId,
      title: course.name,
      amount: course.pricee,
      description: course.meta?.description,
      image_url: course.image_url,
      referalcode: refcode,
    }).toString();

    window.location.href = `coursecart.html?${queryParams}`;
  }
});

function showSuccessToast1() {
  Toastify({
      text: "ðŸŽ‰ Enrolled Successfully",
      duration: 3000, // Auto close after 3 seconds
      close: true, // Show close button
      gravity: "top", // Position on top
      position: "right", // Align to the right
      backgroundColor: "linear-gradient(to right, #38a169, #2f855a)", // Green gradient
      stopOnFocus: true, // Stop dismissing on hover
  }).showToast();
}



    };

    document.addEventListener("DOMContentLoaded", () => {
      // Example: Set the author's name dynamically
      const authorElement = document.getElementById("modal-id");
      const clickElement = document.getElementById("modal-author");
      const authorName = authorElement.textContent.trim(); // Replace this with dynamic data if needed
      authorElement.textContent = authorName;

      // Add a click event listener
      clickElement.addEventListener("click", (event) => {
        event.preventDefault(); // Prevent default link behavior

        // Navigate to the author page
        window.location.href = `authorpages.html?name=${authorElement.textContent.trim()}`;
      });
    });

    // Close Modal
    document.getElementById("close-modal").addEventListener("click", () => {
      document.getElementById("course-modal").style.display = "none";
    });

    document.getElementById("searchInput").addEventListener("input", function () {
    let query = this.value.trim(); // Keep case sensitivity if needed
    let courses = document.querySelectorAll("#course-list > div");

    if (!query) {
        courses.forEach(course => course.style.display = "block");
        return;
    }

    let isCategoryOnly = false; // Flag to determine if input matches only a category

    // Check if the input is exactly a category name
    courses.forEach(course => {
        let categoryElement = course.querySelector(".course-category");
        let categoryName = categoryElement ? categoryElement.textContent.trim() : "";

        if (categoryName === query) {
            isCategoryOnly = true;
        }
    });

    courses.forEach(course => {
        let courseTitle = course.querySelector("h3").textContent.trim();
        let categoryElement = course.querySelector(".course-category");
        let categoryName = categoryElement ? categoryElement.textContent.trim() : "";

        let titleMatch = courseTitle.includes(query);
        let categoryMatch = categoryName === query; // Exact match

        if (isCategoryOnly) {
            // If input is exactly a category name, ignore title match
            course.style.display = categoryMatch ? "block" : "none";
        } else {
            // Otherwise, allow both title and category matching
            course.style.display = titleMatch || categoryMatch ? "block" : "none";
        }
    });
});





    // Initialize
    renderCourses();
</script>





   <script>
    document.getElementById("showFormButton").addEventListener("click", function () {
     window.location.href ='./account.html'
    });

  
   
  </script>
    <script>
      function showErrorToast() {
          Toastify({
              text: "ðŸš¨ Create an account to view courses!",
              duration: 3000,
              close: true,
              gravity: "top",
              position: "right",
              backgroundColor: "linear-gradient(to right, #e74c3c, #c0392b)", // Red error gradient
              stopOnFocus: true,
          }).showToast();
      }
  </script>

<script>
  const cart = [];

  function updateCartUI() {
    const cartItemsContainer = document.getElementById("cart-items");
    const cartTotalElement = document.getElementById("cart-total");
    const cartCountElement = document.getElementById("cart-count");

    if (cart.length === 0) {
      cartItemsContainer.innerHTML = `<p class="text-gray-400 text-sm">Your cart is empty.</p>`;
      cartTotalElement.textContent = "â‚µ0.00";
      cartCountElement.classList.add("hidden");
      return;
    }

    cartItemsContainer.innerHTML = "";
    let total = 0;

    cart.forEach((item, index) => {
      total += parseFloat(item.price);

      const cartItem = document.createElement("div");
      cartItem.className = "flex justify-between items-center p-2 border-b";

      cartItem.innerHTML = `
        <div>
          <p class="text-white text-sm">${item.name}</p>
          <p class="text-green-400 text-xs">â‚µ${item.price}</p>
        </div>
        <button class="text-red-500 text-sm" onclick="removeFromCart(${index})">Remove</button>
      `;

      cartItemsContainer.appendChild(cartItem);
    });

    cartTotalElement.textContent = `â‚µ${total.toFixed(2)}`;
    cartCountElement.textContent = cart.length;
    cartCountElement.classList.remove("hidden");
  }

  function addToCart(event, courseName, coursePrice, courseId, courseDescription, courseImageUrl) {
  event.stopPropagation();

  const price = parseFloat(coursePrice) || 0;
  const userid = auth.currentUser.uid;
  cart.push({
 userid,
    id: courseId,
    name: courseName,
    price,
    description: courseDescription,
    image_url: courseImageUrl
  });

  updateCartUI();
  document.getElementById("cart-container").classList.remove("hidden");
}



  function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartUI();
  }

  document.getElementById("open-cart").addEventListener("click", () => {
    document.getElementById("cart-container").classList.toggle("hidden");
  });

  document.getElementById("close-cart").addEventListener("click", () => {
    document.getElementById("cart-container").classList.add("hidden");
  });
  document.getElementById("checkout-btn").addEventListener("click", async () => {
  if (cart.length === 0) {
    alert("Your cart is empty!");
    return;
  }
// Get current date and add three months
const expireDate = new Date();
expireDate.setMonth(expireDate.getMonth() + 3);
  // Get the current user
  const user = firebase.auth().currentUser;
  if (!user) {
    alert("Please log in to proceed to checkout.");
    return;
  }
  const userid = user.uid;

  // Fetch referral code from Firestore
  let refcode = "";
  try {
    const userDoc = await db.collection("users").doc(userid).get();
    if (userDoc.exists) {
      refcode = userDoc.data().underef || "";
    }
  } catch (error) {
    console.error("Error fetching referral code:", error);
  }

  // Check if all courses in cart are free
  const freeCourses = cart.filter(course => parseFloat(course.price) === 0);
  const paidCourses = cart.filter(course => parseFloat(course.price) > 0);

  if (freeCourses.length > 0 && paidCourses.length === 0) {
    // Enroll user in free courses
    try {
      document.getElementById("loadingScreen").classList.remove("hidden");

      for (const course of freeCourses) {
     // Update user's enrolled courses
// Add course to the Courses subcollection with expire_date
await db.collection("users").doc(userid).collection("Courses").doc(course.id).set({
  course_id: course.id,
  expire_date: firebase.firestore.Timestamp.fromDate(new Date(expireDate)), // Ensure expireDate is a valid Date object
});

      }

      console.log("Free courses enrolled successfully!");
      showSuccessToast();

      // Redirect to "My Courses" after enrolling
      setTimeout(() => {
        window.location.href = "mycourse.html";
      }, 3000);
    } catch (error) {
      console.error("Error enrolling in free courses:", error);
    } finally {
      document.getElementById("loadingScreen").classList.add("hidden");
    }
  } else {
    // Use URLSearchParams for paid courses checkout
    const params = new URLSearchParams();
    params.append("userid", userid);
    params.append("referalcode", refcode);

    // Add only paid courses
    paidCourses.forEach((item) => {
      params.append("id", item.id);
      params.append("title", item.name);
      params.append("amount", item.price);
      params.append("description", item.description || "No description");
      params.append("image_url", item.image_url || "https://via.placeholder.com/150");
    });

    // Redirect to checkout page for paid courses
    window.location.href = `coursecart.html?${params.toString()}`;
  }
});

// Toast notification for successful enrollment
function showSuccessToast() {
  Toastify({
    text: "ðŸŽ‰ Enrolled in free courses successfully!",
    duration: 3000,
    close: true,
    gravity: "top",
    position: "right",
    backgroundColor: "linear-gradient(to right, #38a169, #2f855a)",
    stopOnFocus: true,
  }).showToast();
}





document.addEventListener("click", (event) => {
  const button = event.target.closest(".add-to-cart-btn");

  if (button) {
    
    const courseId = button.dataset.id || "unknown";
    const courseName = button.dataset.title || "Unknown Course";
    const coursePrice = button.dataset.price || "0";
    const courseDescription = button.dataset.description || "No description";
    const courseImageUrl = button.dataset.image || "https://via.placeholder.com/150";

   
    addToCart(event, courseName, coursePrice, courseId, courseDescription, courseImageUrl);
  }
});





</script>




<script>
  function updateShareLinks() {
    const title = document.getElementById("modal-title").innerText;
    const courseId = document.getElementById("modal1-id").innerText;
    const siteUrl = 'https://profstudymate.com' // Get the base site URL
    const storedUserId = localStorage.getItem("userId");
    const url = `${siteUrl}/courses.html?courseid=${courseId}&referral=${storedUserId}`;

    document.getElementById("share-facebook").href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
    document.getElementById("share-twitter").href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`;
    document.getElementById("share-linkedin").href = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`;
    document.getElementById("share-whatsapp").href = `https://wa.me/?text=${encodeURIComponent(title + ' ' + url)}`;
  }


</script>


<script>
  document.getElementById("open-drawer").addEventListener("click", function() {
      document.getElementById("drawer").classList.remove("-translate-x-full");
  });
  document.getElementById("close-drawer").addEventListener("click", function() {
      document.getElementById("drawer").classList.add("-translate-x-full");
  });
</script>


<script>
// Wait for the page to load
// Ensure "Add to Cart" and "Enroll" buttons redirect only if the user is not logged in
document.addEventListener("DOMContentLoaded", function () {
  const urlParams = new URLSearchParams(window.location.search);
    const referral1 = urlParams.get("referral");

    if (referral1) {
        localStorage.setItem("referral", referral1);
       
    }
    firebase.auth().onAuthStateChanged((user) => {
        document.addEventListener("click", (event) => {
            if (event.target.closest(".add-to-cart-btn") || event.target.closest("#modal-enroll-button")) {
                if (!user) {
                    event.preventDefault();
                    window.location.href = "account.html"; // Redirect to login
                }
            }
        });
    });
});

const videoIframe = document.getElementById("modal-video");
const videoElement = document.getElementById("modal-video-player");

function loadVideo(videoUrl) {
    if (!videoUrl) {
        videoIframe.style.display = "none";
        videoElement.style.display = "none";
        return;
    }

  // Check if the video is a YouTube or Google Drive link
if (videoUrl.includes("youtube.com") || videoUrl.includes("youtu.be")) {
    // Convert YouTube watch link to embed link if needed
    if (videoUrl.includes("watch?v=")) {
        videoUrl = videoUrl.replace("watch?v=", "embed/");
    }

    // Show iframe for YouTube
    videoIframe.src = videoUrl;
    videoIframe.style.display = "block";
    videoElement.style.display = "none";

} else if (videoUrl.includes("drive.google.com")) {
    // Extract Google Drive File ID
    const driveRegex = /\/file\/d\/(.*?)\/view/;
    const match = videoUrl.match(driveRegex);

    if (match) {
        const fileId = match[1];
        videoUrl = `https://drive.google.com/file/d/${fileId}/preview`;

        // Show iframe for Google Drive video
        videoIframe.src = videoUrl;
        videoIframe.style.display = "block";
        videoElement.style.display = "none";
    }
} else {
    // Assume it's a Firebase Storage video (MP4, WebM, etc.)
    videoElement.src = videoUrl;
    videoElement.style.display = "block";
    videoIframe.style.display = "none";
}

}

// Example usage: Fetch video URL from Firebase and load it
fetchVideoFromFirebase();

async function fetchVideoFromFirebase() {
    // Simulating Firebase Firestore fetch
    const course = await getCourseFromFirebase(); // Assume this function fetches the video URL
    loadVideo(course.video_url);
}

// Dummy function simulating Firebase data retrieval
async function getCourseFromFirebase() {
    return {
        video_url: "https://firebasestorage.googleapis.com/v0/b/YOUR_PROJECT.appspot.com/o/sample.mp4?alt=media"
        // or "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
    };
}


  </script>

</body>
</html>